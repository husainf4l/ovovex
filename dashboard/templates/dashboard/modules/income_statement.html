{% extends 'modules/base_module.html' %}
{% load static %}

{% block content %}
{% include 'components/sidemenu.html' %}

<div class="min-h-screen bg-gray-50 dark:bg-gray-900 ml-64 transition-colors duration-300">
    <!-- Top Navigation Bar -->
    <div class="bg-white dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700 px-6 py-4 transition-colors duration-300">
        <div class="flex items-center justify-between">
            <div class="flex items-center space-x-4">
                <h1 class="text-2xl font-bold text-gray-900 dark:text-gray-100">Income Statement</h1>
                <span class="px-3 py-1 bg-green-100 dark:bg-green-900 text-green-800 dark:text-green-200 text-sm font-medium rounded-full">Profitable</span>
            </div>
            <div class="flex items-center space-x-4">
                <!-- Quick Search -->
                <div class="relative">
                    <input type="text" placeholder="Search revenue, expenses..." class="w-64 pl-10 pr-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 transition-colors duration-300">
                    <i class="fas fa-search absolute left-3 top-3 text-gray-400 dark:text-gray-500"></i>
                </div>
                <!-- Export -->
                <button id="exportBtn" class="px-4 py-2 bg-blue-600 text-white text-sm font-medium rounded-lg hover:bg-blue-700 transition-colors duration-200">
                    <i class="fas fa-download mr-2"></i>
                    Export
                </button>
                <!-- Theme Toggle -->
                <button id="theme-toggle" class="p-2 text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-100 transition-colors duration-300">
                    <i class="fas fa-moon text-xl dark:hidden"></i>
                    <i class="fas fa-sun text-xl hidden dark:inline"></i>
                </button>
            </div>
        </div>
    </div>

    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 pt-6 pb-8">
        <!-- Breadcrumb -->
        <nav class="flex mb-6" aria-label="Breadcrumb">
            <ol class="inline-flex items-center space-x-1 md:space-x-3">
                <li class="inline-flex items-center">
                    <a href="{% url 'dashboard:dashboard' %}" class="inline-flex items-center text-sm font-medium text-gray-700 dark:text-gray-300 hover:text-blue-600 dark:hover:text-blue-400">
                        <i class="fas fa-home mr-2"></i>
                        Dashboard
                    </a>
                </li>
                <li>
                    <div class="flex items-center">
                        <i class="fas fa-chevron-right text-gray-400 mx-2"></i>
                        <span class="text-sm font-medium text-gray-500 dark:text-gray-400">Income Statement</span>
                    </div>
                </li>
            </ol>
        </nav>

        <!-- Module Description -->
        <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-sm border border-gray-200 dark:border-gray-700 p-6 mb-6">
            <div class="flex items-center justify-between">
                <div>
                    <h2 class="text-xl font-bold text-gray-900 dark:text-gray-100 mb-2">Income Statement</h2>
                    <p class="text-gray-600 dark:text-gray-400">Profit and loss statement showing revenue, expenses, and net income over a period. Track profitability trends and operational efficiency.</p>
                </div>
                <div class="flex items-center space-x-3">
                    <div class="text-right">
                        <div class="text-2xl font-bold text-gray-900 dark:text-gray-100">$158,160</div>
                        <div class="text-sm text-gray-600 dark:text-gray-400">Net Profit</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- KPI Cards -->
        <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-6">
            <!-- Total Revenue -->
            <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-sm border border-gray-200 dark:border-gray-700 p-6">
                <div class="flex items-center justify-between mb-4">
                    <div class="w-10 h-10 bg-green-100 dark:bg-green-900 rounded-lg flex items-center justify-center">
                        <i class="fas fa-arrow-up text-green-600 dark:text-green-400"></i>
                    </div>
                    <span class="text-green-600 dark:text-green-400 text-sm font-medium">+12.5%</span>
                </div>
                <div class="text-2xl font-bold text-gray-900 dark:text-gray-100 mb-1">$247,580</div>
                <div class="text-sm text-gray-600 dark:text-gray-400">Total Revenue</div>
            </div>

            <!-- Total Expenses -->
            <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-sm border border-gray-200 dark:border-gray-700 p-6">
                <div class="flex items-center justify-between mb-4">
                    <div class="w-10 h-10 bg-red-100 dark:bg-red-900 rounded-lg flex items-center justify-center">
                        <i class="fas fa-arrow-down text-red-600 dark:text-red-400"></i>
                    </div>
                    <span class="text-red-600 dark:text-red-400 text-sm font-medium">-3.2%</span>
                </div>
                <div class="text-2xl font-bold text-gray-900 dark:text-gray-100 mb-1">$89,420</div>
                <div class="text-sm text-gray-600 dark:text-gray-400">Total Expenses</div>
            </div>

            <!-- Gross Profit -->
            <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-sm border border-gray-200 dark:border-gray-700 p-6">
                <div class="flex items-center justify-between mb-4">
                    <div class="w-10 h-10 bg-blue-100 dark:bg-blue-900 rounded-lg flex items-center justify-center">
                        <i class="fas fa-chart-line text-blue-600 dark:text-blue-400"></i>
                    </div>
                    <span class="text-green-600 dark:text-green-400 text-sm font-medium">+15.8%</span>
                </div>
                <div class="text-2xl font-bold text-gray-900 dark:text-gray-100 mb-1">$158,160</div>
                <div class="text-sm text-gray-600 dark:text-gray-400">Gross Profit</div>
            </div>

            <!-- Net Profit Margin -->
            <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-sm border border-gray-200 dark:border-gray-700 p-6">
                <div class="flex items-center justify-between mb-4">
                    <div class="w-10 h-10 bg-purple-100 dark:bg-purple-900 rounded-lg flex items-center justify-center">
                        <i class="fas fa-percentage text-purple-600 dark:text-purple-400"></i>
                    </div>
                    <span class="text-green-600 dark:text-green-400 text-sm font-medium">+2.1%</span>
                </div>
                <div class="text-2xl font-bold text-gray-900 dark:text-gray-100 mb-1">63.8%</div>
                <div class="text-sm text-gray-600 dark:text-gray-400">Profit Margin</div>
            </div>
        </div>

        <!-- Quick Actions -->
        <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
            <button id="addRevenueBtn" class="flex items-center justify-center px-4 py-3 bg-blue-600 text-white font-medium rounded-xl hover:bg-blue-700 transition-colors duration-200">
                <i class="fas fa-plus mr-2"></i>
                Add Revenue
            </button>
            <button id="recordExpenseBtn" class="flex items-center justify-center px-4 py-3 bg-green-600 text-white font-medium rounded-xl hover:bg-green-700 transition-colors duration-200">
                <i class="fas fa-receipt mr-2"></i>
                Record Expense
            </button>
            <button id="calculateTaxesBtn" class="flex items-center justify-center px-4 py-3 bg-purple-600 text-white font-medium rounded-xl hover:bg-purple-700 transition-colors duration-200">
                <i class="fas fa-calculator mr-2"></i>
                Calculate Taxes
            </button>
            <button id="trendAnalysisBtn" class="flex items-center justify-center px-4 py-3 bg-gray-600 dark:bg-gray-700 text-white font-medium rounded-xl hover:bg-gray-700 dark:hover:bg-gray-600 transition-colors duration-200">
                <i class="fas fa-chart-bar mr-2"></i>
                Trend Analysis
            </button>
        </div>

        <!-- Income Statement Table -->
        <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-sm border border-gray-200 dark:border-gray-700">
            <div class="p-6 border-b border-gray-200 dark:border-gray-700">
                <div class="flex items-center justify-between">
                    <h3 class="text-xl font-bold text-gray-900 dark:text-gray-100">Income Statement - September 2025</h3>
                    <div class="flex items-center space-x-2">
                        <select class="px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 transition-colors duration-300">
                            <option>September 2025</option>
                            <option>August 2025</option>
                            <option>Q3 2025</option>
                        </select>
                        <button class="p-2 text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-100">
                            <i class="fas fa-download text-sm"></i>
                        </button>
                    </div>
                </div>
            </div>

            <div class="overflow-x-auto">
                <table class="w-full">
                    <thead class="bg-gray-50 dark:bg-gray-700">
                        <tr>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Account</th>
                            <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Current Period</th>
                            <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Previous Period</th>
                            <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Change</th>
                        </tr>
                    </thead>
                    <tbody class="bg-white dark:bg-gray-800">
                        <!-- Revenue -->
                        <tr class="bg-gray-50 dark:bg-gray-700">
                            <td colspan="4" class="px-6 py-3 text-sm font-bold text-gray-900 dark:text-gray-100">REVENUE</td>
                        </tr>
                        <tr>
                            <td class="px-6 py-4 text-sm text-gray-900 dark:text-gray-100 pl-12">Product Sales</td>
                            <td class="px-6 py-4 text-right text-sm text-gray-900 dark:text-gray-100">$185,420</td>
                            <td class="px-6 py-4 text-right text-sm text-gray-600 dark:text-gray-400">$165,890</td>
                            <td class="px-6 py-4 text-right text-sm text-green-600 dark:text-green-400">+$19,530</td>
                        </tr>
                        <tr>
                            <td class="px-6 py-4 text-sm text-gray-900 dark:text-gray-100 pl-12">Service Revenue</td>
                            <td class="px-6 py-4 text-right text-sm text-gray-900 dark:text-gray-100">$62,160</td>
                            <td class="px-6 py-4 text-right text-sm text-gray-600 dark:text-gray-400">$58,780</td>
                            <td class="px-6 py-4 text-right text-sm text-green-600 dark:text-green-400">+$3,380</td>
                        </tr>
                        <tr class="bg-green-50 dark:bg-green-900/20">
                            <td class="px-6 py-3 text-sm font-bold text-gray-900 dark:text-gray-100">TOTAL REVENUE</td>
                            <td class="px-6 py-3 text-right text-sm font-bold text-gray-900 dark:text-gray-100">$247,580</td>
                            <td class="px-6 py-3 text-right text-sm font-bold text-gray-600 dark:text-gray-400">$224,670</td>
                            <td class="px-6 py-3 text-right text-sm font-bold text-green-600 dark:text-green-400">+$22,910</td>
                        </tr>

                        <!-- Cost of Goods Sold -->
                        <tr class="bg-gray-50 dark:bg-gray-700">
                            <td colspan="4" class="px-6 py-3 text-sm font-bold text-gray-900 dark:text-gray-100">COST OF GOODS SOLD</td>
                        </tr>
                        <tr>
                            <td class="px-6 py-4 text-sm text-gray-900 dark:text-gray-100 pl-12">Direct Materials</td>
                            <td class="px-6 py-4 text-right text-sm text-gray-900 dark:text-gray-100">$45,230</td>
                            <td class="px-6 py-4 text-right text-sm text-gray-600 dark:text-gray-400">$42,180</td>
                            <td class="px-6 py-4 text-right text-sm text-red-600 dark:text-red-400">+$3,050</td>
                        </tr>
                        <tr>
                            <td class="px-6 py-4 text-sm text-gray-900 dark:text-gray-100 pl-12">Direct Labor</td>
                            <td class="px-6 py-4 text-right text-sm text-gray-900 dark:text-gray-100">$28,750</td>
                            <td class="px-6 py-4 text-right text-sm text-gray-600 dark:text-gray-400">$26,890</td>
                            <td class="px-6 py-4 text-right text-sm text-red-600 dark:text-red-400">+$1,860</td>
                        </tr>
                        <tr>
                            <td class="px-6 py-4 text-sm text-gray-900 dark:text-gray-100 pl-12">Manufacturing Overhead</td>
                            <td class="px-6 py-4 text-right text-sm text-gray-900 dark:text-gray-100">$15,600</td>
                            <td class="px-6 py-4 text-right text-sm text-gray-600 dark:text-gray-400">$14,780</td>
                            <td class="px-6 py-4 text-right text-sm text-red-600 dark:text-red-400">+$820</td>
                        </tr>
                        <tr class="bg-red-50 dark:bg-red-900/20">
                            <td class="px-6 py-3 text-sm font-bold text-gray-900 dark:text-gray-100">TOTAL COGS</td>
                            <td class="px-6 py-3 text-right text-sm font-bold text-gray-900 dark:text-gray-100">$89,580</td>
                            <td class="px-6 py-3 text-right text-sm font-bold text-gray-600 dark:text-gray-400">$83,850</td>
                            <td class="px-6 py-3 text-right text-sm font-bold text-red-600 dark:text-red-400">+$5,730</td>
                        </tr>

                        <!-- Gross Profit -->
                        <tr class="bg-blue-50 dark:bg-blue-900/20">
                            <td class="px-6 py-3 text-sm font-bold text-gray-900 dark:text-gray-100">GROSS PROFIT</td>
                            <td class="px-6 py-3 text-right text-sm font-bold text-green-600 dark:text-green-400">$158,000</td>
                            <td class="px-6 py-3 text-right text-sm font-bold text-green-600 dark:text-green-400">$140,820</td>
                            <td class="px-6 py-3 text-right text-sm font-bold text-green-600 dark:text-green-400">+$17,180</td>
                        </tr>

                        <!-- Operating Expenses -->
                        <tr class="bg-gray-50 dark:bg-gray-700">
                            <td colspan="4" class="px-6 py-3 text-sm font-bold text-gray-900 dark:text-gray-100">OPERATING EXPENSES</td>
                        </tr>
                        <tr>
                            <td class="px-6 py-4 text-sm text-gray-900 dark:text-gray-100 pl-12">Salaries & Wages</td>
                            <td class="px-6 py-4 text-right text-sm text-gray-900 dark:text-gray-100">$32,450</td>
                            <td class="px-6 py-4 text-right text-sm text-gray-600 dark:text-gray-400">$31,200</td>
                            <td class="px-6 py-4 text-right text-sm text-red-600 dark:text-red-400">+$1,250</td>
                        </tr>
                        <tr>
                            <td class="px-6 py-4 text-sm text-gray-900 dark:text-gray-100 pl-12">Rent & Utilities</td>
                            <td class="px-6 py-4 text-right text-sm text-gray-900 dark:text-gray-100">$12,890</td>
                            <td class="px-6 py-4 text-right text-sm text-gray-600 dark:text-gray-400">$12,450</td>
                            <td class="px-6 py-4 text-right text-sm text-red-600 dark:text-red-400">+$440</td>
                        </tr>
                        <tr>
                            <td class="px-6 py-4 text-sm text-gray-900 dark:text-gray-100 pl-12">Marketing & Advertising</td>
                            <td class="px-6 py-4 text-right text-sm text-gray-900 dark:text-gray-100">$8,750</td>
                            <td class="px-6 py-4 text-right text-sm text-gray-600 dark:text-gray-400">$9,200</td>
                            <td class="px-6 py-4 text-right text-sm text-green-600 dark:text-green-400">-$450</td>
                        </tr>
                        <tr>
                            <td class="px-6 py-4 text-sm text-gray-900 dark:text-gray-100 pl-12">Office Supplies</td>
                            <td class="px-6 py-4 text-right text-sm text-gray-900 dark:text-gray-100">$5,420</td>
                            <td class="px-6 py-4 text-right text-sm text-gray-600 dark:text-gray-400">$5,890</td>
                            <td class="px-6 py-4 text-right text-sm text-green-600 dark:text-green-400">-$470</td>
                        </tr>
                        <tr>
                            <td class="px-6 py-4 text-sm text-gray-900 dark:text-gray-100 pl-12">Depreciation</td>
                            <td class="px-6 py-4 text-right text-sm text-gray-900 dark:text-gray-100">$3,200</td>
                            <td class="px-6 py-4 text-right text-sm text-gray-600 dark:text-gray-400">$3,200</td>
                            <td class="px-6 py-4 text-right text-sm text-gray-600 dark:text-gray-400">$0</td>
                        </tr>
                        <tr class="bg-red-50 dark:bg-red-900/20">
                            <td class="px-6 py-3 text-sm font-bold text-gray-900 dark:text-gray-100">TOTAL OPERATING EXPENSES</td>
                            <td class="px-6 py-3 text-right text-sm font-bold text-gray-900 dark:text-gray-100">$62,710</td>
                            <td class="px-6 py-3 text-right text-sm font-bold text-gray-600 dark:text-gray-400">$61,940</td>
                            <td class="px-6 py-3 text-right text-sm font-bold text-red-600 dark:text-red-400">+$770</td>
                        </tr>

                        <!-- Net Profit -->
                        <tr class="bg-green-50 dark:bg-green-900/20">
                            <td class="px-6 py-3 text-sm font-bold text-gray-900 dark:text-gray-100">NET PROFIT</td>
                            <td class="px-6 py-3 text-right text-sm font-bold text-green-600 dark:text-green-400">$95,290</td>
                            <td class="px-6 py-3 text-right text-sm font-bold text-green-600 dark:text-green-400">$78,880</td>
                            <td class="px-6 py-3 text-right text-sm font-bold text-green-600 dark:text-green-400">+$16,410</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Performance Metrics -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mt-6">
            <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-sm border border-gray-200 dark:border-gray-700 p-6">
                <h4 class="text-lg font-bold text-gray-900 dark:text-gray-100 mb-4">Profitability Ratios</h4>
                <div class="space-y-3">
                    <div class="flex justify-between">
                        <span class="text-sm text-gray-600 dark:text-gray-400">Gross Margin</span>
                        <span class="text-sm font-medium text-gray-900 dark:text-gray-100">63.8%</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-sm text-gray-600 dark:text-gray-400">Operating Margin</span>
                        <span class="text-sm font-medium text-gray-900 dark:text-gray-100">38.4%</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-sm text-gray-600 dark:text-gray-400">Net Profit Margin</span>
                        <span class="text-sm font-medium text-gray-900 dark:text-gray-100">25.3%</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-sm text-gray-600 dark:text-gray-400">Return on Sales</span>
                        <span class="text-sm font-medium text-green-600 dark:text-green-400">38.4%</span>
                    </div>
                </div>
            </div>

            <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-sm border border-gray-200 dark:border-gray-700 p-6">
                <h4 class="text-lg font-bold text-gray-900 dark:text-gray-100 mb-4">Revenue Breakdown</h4>
                <div class="space-y-3">
                    <div class="flex justify-between items-center">
                        <span class="text-sm text-gray-600 dark:text-gray-400">Product Sales</span>
                        <div class="flex items-center space-x-2">
                            <div class="w-16 bg-gray-200 dark:bg-gray-700 rounded-full h-2">
                                <div class="bg-blue-600 h-2 rounded-full" style="width: 74.8%"></div>
                            </div>
                            <span class="text-sm font-medium text-gray-900 dark:text-gray-100">74.8%</span>
                        </div>
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="text-sm text-gray-600 dark:text-gray-400">Services</span>
                        <div class="flex items-center space-x-2">
                            <div class="w-16 bg-gray-200 dark:bg-gray-700 rounded-full h-2">
                                <div class="bg-green-600 h-2 rounded-full" style="width: 25.2%"></div>
                            </div>
                            <span class="text-sm font-medium text-gray-900 dark:text-gray-100">25.2%</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-sm border border-gray-200 dark:border-gray-700 p-6">
                <h4 class="text-lg font-bold text-gray-900 dark:text-gray-100 mb-4">Expense Analysis</h4>
                <div class="space-y-3">
                    <div class="flex justify-between">
                        <span class="text-sm text-gray-600 dark:text-gray-400">Top Expense</span>
                        <span class="text-sm font-medium text-gray-900 dark:text-gray-100">Salaries</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-sm text-gray-600 dark:text-gray-400">Expense Growth</span>
                        <span class="text-sm font-medium text-red-600 dark:text-red-400">+1.2%</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-sm text-gray-600 dark:text-gray-400">Expense Ratio</span>
                        <span class="text-sm font-medium text-gray-900 dark:text-gray-100">36.1%</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Add Revenue Modal -->
<div id="addRevenueModal" class="hidden fixed inset-0 bg-gray-900 bg-opacity-50 z-50 flex items-center justify-center p-4">
    <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-2xl max-w-3xl w-full max-h-[90vh] overflow-y-auto">
        <div class="p-6 border-b border-gray-200 dark:border-gray-700 flex items-center justify-between sticky top-0 bg-white dark:bg-gray-800 z-10">
            <h3 class="text-2xl font-bold text-gray-900 dark:text-gray-100">Add Revenue</h3>
            <button class="closeModal text-gray-400 hover:text-gray-600 dark:hover:text-gray-200">
                <i class="fas fa-times text-2xl"></i>
            </button>
        </div>
        <div class="p-6">
            <form id="addRevenueForm" class="space-y-6">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Date *</label>
                        <input type="date" id="revenueDate" class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100" required>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Revenue Type *</label>
                        <select id="revenueType" class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100" required>
                            <option value="">Select type...</option>
                            <option value="product_sales">Product Sales</option>
                            <option value="service_revenue">Service Revenue</option>
                            <option value="interest_income">Interest Income</option>
                            <option value="other_income">Other Income</option>
                        </select>
                    </div>
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Customer</label>
                    <select id="revenueCustomer" class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100">
                        <option value="">Select customer (optional)...</option>
                        <option value="cust1">Acme Corporation</option>
                        <option value="cust2">TechStart Inc</option>
                        <option value="cust3">Global Industries</option>
                    </select>
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Description *</label>
                    <textarea id="revenueDescription" rows="3" class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100" placeholder="Enter revenue description..." required></textarea>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Amount *</label>
                        <div class="relative">
                            <span class="absolute left-3 top-2 text-gray-500 dark:text-gray-400">$</span>
                            <input type="number" step="0.01" min="0" id="revenueAmount" class="w-full pl-8 pr-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100" placeholder="0.00" required>
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Payment Method</label>
                        <select id="revenuePaymentMethod" class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100">
                            <option value="cash">Cash</option>
                            <option value="check">Check</option>
                            <option value="credit_card">Credit Card</option>
                            <option value="bank_transfer">Bank Transfer</option>
                            <option value="other">Other</option>
                        </select>
                    </div>
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Reference Number</label>
                    <input type="text" id="revenueReference" class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100" placeholder="Optional reference number">
                </div>

                <div>
                    <label class="flex items-center">
                        <input type="checkbox" id="createJournalEntry" class="rounded border-gray-300 text-blue-600 focus:ring-blue-500" checked>
                        <span class="ml-2 text-sm text-gray-700 dark:text-gray-300">Automatically create journal entry</span>
                    </label>
                </div>

                <div class="flex justify-end space-x-4 pt-4 border-t border-gray-200 dark:border-gray-700">
                    <button type="button" class="closeModal px-6 py-2 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700">
                        Cancel
                    </button>
                    <button type="submit" class="px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">
                        <i class="fas fa-plus mr-2"></i>
                        Add Revenue
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Record Expense Modal -->
<div id="recordExpenseModal" class="hidden fixed inset-0 bg-gray-900 bg-opacity-50 z-50 flex items-center justify-center p-4">
    <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-2xl max-w-3xl w-full max-h-[90vh] overflow-y-auto">
        <div class="p-6 border-b border-gray-200 dark:border-gray-700 flex items-center justify-between sticky top-0 bg-white dark:bg-gray-800 z-10">
            <h3 class="text-2xl font-bold text-gray-900 dark:text-gray-100">Record Expense</h3>
            <button class="closeModal text-gray-400 hover:text-gray-600 dark:hover:text-gray-200">
                <i class="fas fa-times text-2xl"></i>
            </button>
        </div>
        <div class="p-6">
            <form id="recordExpenseForm" class="space-y-6">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Date *</label>
                        <input type="date" id="expenseDate" class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100" required>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Expense Category *</label>
                        <select id="expenseCategory" class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100" required>
                            <option value="">Select category...</option>
                            <option value="salaries">Salaries & Wages</option>
                            <option value="rent">Rent & Utilities</option>
                            <option value="marketing">Marketing & Advertising</option>
                            <option value="office_supplies">Office Supplies</option>
                            <option value="travel">Travel & Entertainment</option>
                            <option value="insurance">Insurance</option>
                            <option value="depreciation">Depreciation</option>
                            <option value="other">Other Expenses</option>
                        </select>
                    </div>
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Vendor</label>
                    <select id="expenseVendor" class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100">
                        <option value="">Select vendor (optional)...</option>
                        <option value="vendor1">Office Supplies Co</option>
                        <option value="vendor2">Utility Company</option>
                        <option value="vendor3">Marketing Agency</option>
                    </select>
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Description *</label>
                    <textarea id="expenseDescription" rows="3" class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100" placeholder="Enter expense description..." required></textarea>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Amount *</label>
                        <div class="relative">
                            <span class="absolute left-3 top-2 text-gray-500 dark:text-gray-400">$</span>
                            <input type="number" step="0.01" min="0" id="expenseAmount" class="w-full pl-8 pr-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100" placeholder="0.00" required>
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Payment Method</label>
                        <select id="expensePaymentMethod" class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100">
                            <option value="cash">Cash</option>
                            <option value="check">Check</option>
                            <option value="credit_card">Credit Card</option>
                            <option value="bank_transfer">Bank Transfer</option>
                            <option value="other">Other</option>
                        </select>
                    </div>
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Receipt/Invoice Number</label>
                    <input type="text" id="expenseReceipt" class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100" placeholder="Optional receipt number">
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Attach Receipt (Optional)</label>
                    <div class="flex items-center justify-center w-full">
                        <label class="flex flex-col items-center justify-center w-full h-32 border-2 border-gray-300 dark:border-gray-600 border-dashed rounded-lg cursor-pointer bg-gray-50 dark:bg-gray-700 hover:bg-gray-100 dark:hover:bg-gray-600">
                            <div class="flex flex-col items-center justify-center pt-5 pb-6">
                                <i class="fas fa-cloud-upload-alt text-3xl text-gray-400 dark:text-gray-500 mb-2"></i>
                                <p class="mb-2 text-sm text-gray-500 dark:text-gray-400"><span class="font-semibold">Click to upload</span> or drag and drop</p>
                                <p class="text-xs text-gray-500 dark:text-gray-400">PDF, PNG, JPG (MAX. 5MB)</p>
                            </div>
                            <input type="file" class="hidden" accept=".pdf,.png,.jpg,.jpeg">
                        </label>
                    </div>
                </div>

                <div>
                    <label class="flex items-center">
                        <input type="checkbox" id="expenseCreateJournal" class="rounded border-gray-300 text-blue-600 focus:ring-blue-500" checked>
                        <span class="ml-2 text-sm text-gray-700 dark:text-gray-300">Automatically create journal entry</span>
                    </label>
                </div>

                <div class="flex justify-end space-x-4 pt-4 border-t border-gray-200 dark:border-gray-700">
                    <button type="button" class="closeModal px-6 py-2 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700">
                        Cancel
                    </button>
                    <button type="submit" class="px-6 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700">
                        <i class="fas fa-save mr-2"></i>
                        Record Expense
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Calculate Taxes Modal -->
<div id="calculateTaxesModal" class="hidden fixed inset-0 bg-gray-900 bg-opacity-50 z-50 flex items-center justify-center p-4">
    <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-y-auto">
        <div class="p-6 border-b border-gray-200 dark:border-gray-700 flex items-center justify-between sticky top-0 bg-white dark:bg-gray-800 z-10">
            <h3 class="text-2xl font-bold text-gray-900 dark:text-gray-100">Calculate Taxes</h3>
            <button class="closeModal text-gray-400 hover:text-gray-600 dark:hover:text-gray-200">
                <i class="fas fa-times text-2xl"></i>
            </button>
        </div>
        <div class="p-6">
            <form id="calculateTaxesForm" class="space-y-6">
                <div class="bg-blue-50 dark:bg-blue-900/20 p-4 rounded-lg">
                    <h4 class="text-sm font-semibold text-blue-900 dark:text-blue-200 mb-2">Tax Calculation Period</h4>
                    <p class="text-xs text-blue-700 dark:text-blue-300">Select the period for which you want to calculate taxes</p>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Tax Period *</label>
                        <select id="taxPeriod" class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100" required>
                            <option value="monthly">Monthly</option>
                            <option value="quarterly">Quarterly</option>
                            <option value="annual">Annual</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Start Date *</label>
                        <input type="date" id="taxStartDate" class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100" required>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">End Date *</label>
                        <input type="date" id="taxEndDate" class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100" required>
                    </div>
                </div>

                <div class="border-t border-gray-200 dark:border-gray-700 pt-6">
                    <h4 class="text-lg font-semibold text-gray-900 dark:text-gray-100 mb-4">Income Summary</h4>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div class="bg-gray-50 dark:bg-gray-700 p-4 rounded-lg">
                            <div class="text-sm text-gray-600 dark:text-gray-400 mb-1">Gross Revenue</div>
                            <div class="text-2xl font-bold text-gray-900 dark:text-gray-100">$247,580</div>
                        </div>
                        <div class="bg-gray-50 dark:bg-gray-700 p-4 rounded-lg">
                            <div class="text-sm text-gray-600 dark:text-gray-400 mb-1">Total Deductions</div>
                            <div class="text-2xl font-bold text-gray-900 dark:text-gray-100">$152,290</div>
                        </div>
                        <div class="bg-green-50 dark:bg-green-900/20 p-4 rounded-lg">
                            <div class="text-sm text-gray-600 dark:text-gray-400 mb-1">Taxable Income</div>
                            <div class="text-2xl font-bold text-green-600 dark:text-green-400">$95,290</div>
                        </div>
                        <div class="bg-gray-50 dark:bg-gray-700 p-4 rounded-lg">
                            <div class="text-sm text-gray-600 dark:text-gray-400 mb-1">Effective Tax Rate</div>
                            <div class="text-2xl font-bold text-gray-900 dark:text-gray-100">21%</div>
                        </div>
                    </div>
                </div>

                <div class="border-t border-gray-200 dark:border-gray-700 pt-6">
                    <h4 class="text-lg font-semibold text-gray-900 dark:text-gray-100 mb-4">Tax Breakdown</h4>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center p-3 bg-gray-50 dark:bg-gray-700 rounded-lg">
                            <div>
                                <div class="font-medium text-gray-900 dark:text-gray-100">Federal Income Tax</div>
                                <div class="text-sm text-gray-600 dark:text-gray-400">21% of taxable income</div>
                            </div>
                            <div class="text-lg font-bold text-gray-900 dark:text-gray-100">$20,011</div>
                        </div>
                        <div class="flex justify-between items-center p-3 bg-gray-50 dark:bg-gray-700 rounded-lg">
                            <div>
                                <div class="font-medium text-gray-900 dark:text-gray-100">State Income Tax</div>
                                <div class="text-sm text-gray-600 dark:text-gray-400">5% of taxable income</div>
                            </div>
                            <div class="text-lg font-bold text-gray-900 dark:text-gray-100">$4,765</div>
                        </div>
                        <div class="flex justify-between items-center p-3 bg-purple-50 dark:bg-purple-900/20 rounded-lg border-2 border-purple-200 dark:border-purple-800">
                            <div>
                                <div class="font-bold text-purple-900 dark:text-purple-200">Total Tax Liability</div>
                                <div class="text-sm text-purple-700 dark:text-purple-300">Federal + State taxes</div>
                            </div>
                            <div class="text-2xl font-bold text-purple-600 dark:text-purple-400">$24,776</div>
                        </div>
                    </div>
                </div>

                <div class="border-t border-gray-200 dark:border-gray-700 pt-6">
                    <h4 class="text-lg font-semibold text-gray-900 dark:text-gray-100 mb-4">Tax Deductions & Credits</h4>
                    <div class="space-y-2">
                        <label class="flex items-center p-3 bg-gray-50 dark:bg-gray-700 rounded-lg cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-600">
                            <input type="checkbox" class="rounded border-gray-300 text-blue-600 focus:ring-blue-500" checked>
                            <div class="ml-3 flex-1">
                                <div class="text-sm font-medium text-gray-900 dark:text-gray-100">Business Expenses</div>
                                <div class="text-xs text-gray-600 dark:text-gray-400">Deductible operating expenses</div>
                            </div>
                            <div class="text-sm font-bold text-gray-900 dark:text-gray-100">$62,710</div>
                        </label>
                        <label class="flex items-center p-3 bg-gray-50 dark:bg-gray-700 rounded-lg cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-600">
                            <input type="checkbox" class="rounded border-gray-300 text-blue-600 focus:ring-blue-500" checked>
                            <div class="ml-3 flex-1">
                                <div class="text-sm font-medium text-gray-900 dark:text-gray-100">Depreciation</div>
                                <div class="text-xs text-gray-600 dark:text-gray-400">Asset depreciation deduction</div>
                            </div>
                            <div class="text-sm font-bold text-gray-900 dark:text-gray-100">$3,200</div>
                        </label>
                    </div>
                </div>

                <div class="flex justify-end space-x-4 pt-4 border-t border-gray-200 dark:border-gray-700">
                    <button type="button" class="closeModal px-6 py-2 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700">
                        Close
                    </button>
                    <button type="button" id="generateTaxReportBtn" class="px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">
                        <i class="fas fa-file-pdf mr-2"></i>
                        Generate Tax Report
                    </button>
                    <button type="submit" class="px-6 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700">
                        <i class="fas fa-calculator mr-2"></i>
                        Record Tax Entry
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Trend Analysis Modal -->
<div id="trendAnalysisModal" class="hidden fixed inset-0 bg-gray-900 bg-opacity-50 z-50 flex items-center justify-center p-4">
    <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-2xl max-w-6xl w-full max-h-[90vh] overflow-y-auto">
        <div class="p-6 border-b border-gray-200 dark:border-gray-700 flex items-center justify-between sticky top-0 bg-white dark:bg-gray-800 z-10">
            <h3 class="text-2xl font-bold text-gray-900 dark:text-gray-100">Trend Analysis</h3>
            <button class="closeModal text-gray-400 hover:text-gray-600 dark:hover:text-gray-200">
                <i class="fas fa-times text-2xl"></i>
            </button>
        </div>
        <div class="p-6">
            <div class="space-y-6">
                <!-- Analysis Options -->
                <div class="bg-blue-50 dark:bg-blue-900/20 p-4 rounded-lg">
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Analysis Type</label>
                            <select id="analysisType" class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100">
                                <option value="revenue">Revenue Trends</option>
                                <option value="expenses">Expense Trends</option>
                                <option value="profit">Profit Trends</option>
                                <option value="margins">Margin Analysis</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Time Period</label>
                            <select id="trendPeriod" class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100">
                                <option value="6months">Last 6 Months</option>
                                <option value="12months">Last 12 Months</option>
                                <option value="2years">Last 2 Years</option>
                                <option value="custom">Custom Range</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Comparison</label>
                            <select id="comparisonType" class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100">
                                <option value="yoy">Year over Year</option>
                                <option value="mom">Month over Month</option>
                                <option value="qoq">Quarter over Quarter</option>
                            </select>
                        </div>
                        <div class="flex items-end">
                            <button id="updateTrendBtn" class="w-full px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">
                                <i class="fas fa-sync mr-2"></i>
                                Update
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Trend Chart Placeholder -->
                <div class="bg-gray-50 dark:bg-gray-700 rounded-xl p-6">
                    <div class="flex items-center justify-center h-80 border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg">
                        <div class="text-center">
                            <i class="fas fa-chart-line text-6xl text-gray-400 dark:text-gray-500 mb-4"></i>
                            <p class="text-gray-600 dark:text-gray-400 text-lg font-medium">Interactive Trend Chart</p>
                            <p class="text-gray-500 dark:text-gray-500 text-sm mt-2">Revenue, expenses, and profit trends visualization</p>
                        </div>
                    </div>
                </div>

                <!-- Key Insights -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div class="bg-green-50 dark:bg-green-900/20 p-4 rounded-lg border border-green-200 dark:border-green-800">
                        <div class="flex items-center justify-between mb-2">
                            <h4 class="text-sm font-semibold text-green-900 dark:text-green-200">Revenue Growth</h4>
                            <i class="fas fa-arrow-up text-green-600 dark:text-green-400"></i>
                        </div>
                        <div class="text-2xl font-bold text-green-600 dark:text-green-400 mb-1">+12.5%</div>
                        <p class="text-xs text-green-700 dark:text-green-300">Compared to previous period</p>
                    </div>
                    <div class="bg-blue-50 dark:bg-blue-900/20 p-4 rounded-lg border border-blue-200 dark:border-blue-800">
                        <div class="flex items-center justify-between mb-2">
                            <h4 class="text-sm font-semibold text-blue-900 dark:text-blue-200">Profit Margin</h4>
                            <i class="fas fa-chart-pie text-blue-600 dark:text-blue-400"></i>
                        </div>
                        <div class="text-2xl font-bold text-blue-600 dark:text-blue-400 mb-1">38.4%</div>
                        <p class="text-xs text-blue-700 dark:text-blue-300">Improving steadily</p>
                    </div>
                    <div class="bg-purple-50 dark:bg-purple-900/20 p-4 rounded-lg border border-purple-200 dark:border-purple-800">
                        <div class="flex items-center justify-between mb-2">
                            <h4 class="text-sm font-semibold text-purple-900 dark:text-purple-200">Expense Control</h4>
                            <i class="fas fa-check-circle text-purple-600 dark:text-purple-400"></i>
                        </div>
                        <div class="text-2xl font-bold text-purple-600 dark:text-purple-400 mb-1">-3.2%</div>
                        <p class="text-xs text-purple-700 dark:text-purple-300">Expenses decreased</p>
                    </div>
                </div>

                <!-- Detailed Trends Table -->
                <div class="bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 overflow-hidden">
                    <table class="w-full">
                        <thead class="bg-gray-50 dark:bg-gray-700">
                            <tr>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase">Period</th>
                                <th class="px-4 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-400 uppercase">Revenue</th>
                                <th class="px-4 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-400 uppercase">Expenses</th>
                                <th class="px-4 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-400 uppercase">Net Profit</th>
                                <th class="px-4 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-400 uppercase">Margin</th>
                                <th class="px-4 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-400 uppercase">Growth</th>
                            </tr>
                        </thead>
                        <tbody class="divide-y divide-gray-200 dark:divide-gray-700">
                            <tr class="bg-blue-50 dark:bg-blue-900/20">
                                <td class="px-4 py-3 text-sm font-medium text-gray-900 dark:text-gray-100">Sep 2025</td>
                                <td class="px-4 py-3 text-sm text-right text-gray-900 dark:text-gray-100">$247,580</td>
                                <td class="px-4 py-3 text-sm text-right text-gray-900 dark:text-gray-100">$152,290</td>
                                <td class="px-4 py-3 text-sm text-right text-green-600 dark:text-green-400 font-medium">$95,290</td>
                                <td class="px-4 py-3 text-sm text-right text-gray-900 dark:text-gray-100">38.4%</td>
                                <td class="px-4 py-3 text-sm text-right text-green-600 dark:text-green-400">+12.5%</td>
                            </tr>
                            <tr>
                                <td class="px-4 py-3 text-sm text-gray-900 dark:text-gray-100">Aug 2025</td>
                                <td class="px-4 py-3 text-sm text-right text-gray-900 dark:text-gray-100">$224,670</td>
                                <td class="px-4 py-3 text-sm text-right text-gray-900 dark:text-gray-100">$145,790</td>
                                <td class="px-4 py-3 text-sm text-right text-green-600 dark:text-green-400">$78,880</td>
                                <td class="px-4 py-3 text-sm text-right text-gray-900 dark:text-gray-100">35.1%</td>
                                <td class="px-4 py-3 text-sm text-right text-green-600 dark:text-green-400">+8.2%</td>
                            </tr>
                            <tr>
                                <td class="px-4 py-3 text-sm text-gray-900 dark:text-gray-100">Jul 2025</td>
                                <td class="px-4 py-3 text-sm text-right text-gray-900 dark:text-gray-100">$212,340</td>
                                <td class="px-4 py-3 text-sm text-right text-gray-900 dark:text-gray-100">$138,560</td>
                                <td class="px-4 py-3 text-sm text-right text-green-600 dark:text-green-400">$73,780</td>
                                <td class="px-4 py-3 text-sm text-right text-gray-900 dark:text-gray-100">34.7%</td>
                                <td class="px-4 py-3 text-sm text-right text-green-600 dark:text-green-400">+5.8%</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <div class="flex justify-end space-x-4 pt-4 border-t border-gray-200 dark:border-gray-700">
                    <button type="button" class="closeModal px-6 py-2 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700">
                        Close
                    </button>
                    <button type="button" id="exportTrendDataBtn" class="px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">
                        <i class="fas fa-download mr-2"></i>
                        Export Analysis
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Export Modal -->
<div id="exportModal" class="hidden fixed inset-0 bg-gray-900 bg-opacity-50 z-50 flex items-center justify-center p-4">
    <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-2xl max-w-2xl w-full">
        <div class="p-6 border-b border-gray-200 dark:border-gray-700 flex items-center justify-between">
            <h3 class="text-2xl font-bold text-gray-900 dark:text-gray-100">Export Income Statement</h3>
            <button class="closeModal text-gray-400 hover:text-gray-600 dark:hover:text-gray-200">
                <i class="fas fa-times text-2xl"></i>
            </button>
        </div>
        <div class="p-6">
            <form id="exportForm" class="space-y-6">
                <div>
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Report Period *</label>
                    <select id="exportPeriod" class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100" required>
                        <option value="current_month">Current Month (Sep 2025)</option>
                        <option value="last_month">Last Month (Aug 2025)</option>
                        <option value="current_quarter">Current Quarter (Q3 2025)</option>
                        <option value="current_year">Year to Date (2025)</option>
                        <option value="custom">Custom Range</option>
                    </select>
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Report Type *</label>
                    <select id="exportReportType" class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100" required>
                        <option value="standard">Standard Income Statement</option>
                        <option value="comparative">Comparative Income Statement</option>
                        <option value="detailed">Detailed P&L Report</option>
                        <option value="summary">Summary Report</option>
                    </select>
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Export Format *</label>
                    <div class="grid grid-cols-3 gap-3">
                        <label class="flex items-center justify-center px-4 py-3 border-2 border-gray-300 dark:border-gray-600 rounded-lg cursor-pointer hover:border-blue-500 transition-colors">
                            <input type="radio" name="exportFormat" value="pdf" class="hidden peer" checked>
                            <div class="text-center peer-checked:text-blue-600">
                                <i class="fas fa-file-pdf text-2xl mb-1"></i>
                                <p class="text-xs font-medium">PDF</p>
                            </div>
                        </label>
                        <label class="flex items-center justify-center px-4 py-3 border-2 border-gray-300 dark:border-gray-600 rounded-lg cursor-pointer hover:border-blue-500 transition-colors">
                            <input type="radio" name="exportFormat" value="excel" class="hidden peer">
                            <div class="text-center peer-checked:text-blue-600">
                                <i class="fas fa-file-excel text-2xl mb-1"></i>
                                <p class="text-xs font-medium">Excel</p>
                            </div>
                        </label>
                        <label class="flex items-center justify-center px-4 py-3 border-2 border-gray-300 dark:border-gray-600 rounded-lg cursor-pointer hover:border-blue-500 transition-colors">
                            <input type="radio" name="exportFormat" value="csv" class="hidden peer">
                            <div class="text-center peer-checked:text-blue-600">
                                <i class="fas fa-file-csv text-2xl mb-1"></i>
                                <p class="text-xs font-medium">CSV</p>
                            </div>
                        </label>
                    </div>
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Include Options</label>
                    <div class="space-y-2">
                        <label class="flex items-center">
                            <input type="checkbox" id="includeCharts" class="rounded border-gray-300 text-blue-600 focus:ring-blue-500" checked>
                            <span class="ml-2 text-sm text-gray-700 dark:text-gray-300">Include charts and graphs</span>
                        </label>
                        <label class="flex items-center">
                            <input type="checkbox" id="includeComparison" class="rounded border-gray-300 text-blue-600 focus:ring-blue-500" checked>
                            <span class="ml-2 text-sm text-gray-700 dark:text-gray-300">Include period comparison</span>
                        </label>
                        <label class="flex items-center">
                            <input type="checkbox" id="includeRatios" class="rounded border-gray-300 text-blue-600 focus:ring-blue-500" checked>
                            <span class="ml-2 text-sm text-gray-700 dark:text-gray-300">Include financial ratios</span>
                        </label>
                        <label class="flex items-center">
                            <input type="checkbox" id="includeNotes" class="rounded border-gray-300 text-blue-600 focus:ring-blue-500">
                            <span class="ml-2 text-sm text-gray-700 dark:text-gray-300">Include notes and annotations</span>
                        </label>
                    </div>
                </div>

                <div class="flex justify-end space-x-4 pt-4 border-t border-gray-200 dark:border-gray-700">
                    <button type="button" class="closeModal px-6 py-2 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700">
                        Cancel
                    </button>
                    <button type="button" id="previewExportBtn" class="px-6 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700">
                        <i class="fas fa-eye mr-2"></i>
                        Preview
                    </button>
                    <button type="submit" class="px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">
                        <i class="fas fa-download mr-2"></i>
                        Export
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Theme Toggle Script -->
<script>
    // Theme toggle
    const themeToggle = document.getElementById('theme-toggle');
    themeToggle.addEventListener('click', () => {
        const html = document.documentElement;
        const isDark = html.classList.contains('dark');
        if (isDark) {
            html.classList.remove('dark');
            localStorage.setItem('theme', 'light');
        } else {
            html.classList.add('dark');
            localStorage.setItem('theme', 'dark');
        }
    });

    // Modal Management
    const modals = {
        addRevenue: document.getElementById('addRevenueModal'),
        recordExpense: document.getElementById('recordExpenseModal'),
        calculateTaxes: document.getElementById('calculateTaxesModal'),
        trendAnalysis: document.getElementById('trendAnalysisModal'),
        export: document.getElementById('exportModal')
    };

    // Open modal functions
    document.getElementById('addRevenueBtn').addEventListener('click', () => {
        modals.addRevenue.classList.remove('hidden');
        document.getElementById('revenueDate').valueAsDate = new Date();
    });

    document.getElementById('recordExpenseBtn').addEventListener('click', () => {
        modals.recordExpense.classList.remove('hidden');
        document.getElementById('expenseDate').valueAsDate = new Date();
    });

    document.getElementById('calculateTaxesBtn').addEventListener('click', () => {
        modals.calculateTaxes.classList.remove('hidden');
        const today = new Date();
        const firstDay = new Date(today.getFullYear(), today.getMonth(), 1);
        const lastDay = new Date(today.getFullYear(), today.getMonth() + 1, 0);
        document.getElementById('taxStartDate').valueAsDate = firstDay;
        document.getElementById('taxEndDate').valueAsDate = lastDay;
    });

    document.getElementById('trendAnalysisBtn').addEventListener('click', () => {
        modals.trendAnalysis.classList.remove('hidden');
    });

    document.getElementById('exportBtn').addEventListener('click', () => {
        modals.export.classList.remove('hidden');
    });

    // Close modal functionality
    document.querySelectorAll('.closeModal').forEach(btn => {
        btn.addEventListener('click', function() {
            this.closest('[id$="Modal"]').classList.add('hidden');
        });
    });

    // Close on outside click
    Object.values(modals).forEach(modal => {
        modal.addEventListener('click', (e) => {
            if (e.target === modal) {
                modal.classList.add('hidden');
            }
        });
    });

    // Add Revenue Form Submit
    document.getElementById('addRevenueForm').addEventListener('submit', (e) => {
        e.preventDefault();
        const revenueData = {
            date: document.getElementById('revenueDate').value,
            type: document.getElementById('revenueType').value,
            amount: document.getElementById('revenueAmount').value,
            description: document.getElementById('revenueDescription').value
        };
        console.log('Adding revenue:', revenueData);
        alert(`Revenue of $${revenueData.amount} added successfully! (This would submit to backend in production)`);
        modals.addRevenue.classList.add('hidden');
        document.getElementById('addRevenueForm').reset();
    });

    // Record Expense Form Submit
    document.getElementById('recordExpenseForm').addEventListener('submit', (e) => {
        e.preventDefault();
        const expenseData = {
            date: document.getElementById('expenseDate').value,
            category: document.getElementById('expenseCategory').value,
            amount: document.getElementById('expenseAmount').value,
            description: document.getElementById('expenseDescription').value
        };
        console.log('Recording expense:', expenseData);
        alert(`Expense of $${expenseData.amount} recorded successfully! (This would submit to backend in production)`);
        modals.recordExpense.classList.add('hidden');
        document.getElementById('recordExpenseForm').reset();
    });

    // Calculate Taxes Form Submit
    document.getElementById('calculateTaxesForm').addEventListener('submit', (e) => {
        e.preventDefault();
        alert('Tax entry recorded successfully! (This would create journal entry in production)');
        modals.calculateTaxes.classList.add('hidden');
    });

    // Generate Tax Report Button
    document.getElementById('generateTaxReportBtn').addEventListener('click', () => {
        alert('Generating tax report... (This would generate PDF report in production)');
    });

    // Update Trend Button
    document.getElementById('updateTrendBtn').addEventListener('click', () => {
        const analysisType = document.getElementById('analysisType').value;
        const period = document.getElementById('trendPeriod').value;
        alert(`Updating ${analysisType} analysis for ${period}... (This would refresh chart in production)`);
    });

    // Export Trend Data Button
    document.getElementById('exportTrendDataBtn').addEventListener('click', () => {
        alert('Exporting trend analysis data... (This would download file in production)');
    });

    // Export Form Submit
    document.getElementById('exportForm').addEventListener('submit', (e) => {
        e.preventDefault();
        const format = document.querySelector('input[name="exportFormat"]:checked').value;
        const reportType = document.getElementById('exportReportType').value;
        alert(`Exporting ${reportType} as ${format.toUpperCase()}... (This would generate and download in production)`);
        modals.export.classList.add('hidden');
    });

    // Preview Export Button
    document.getElementById('previewExportBtn').addEventListener('click', () => {
        alert('Report preview would open here! (This would show preview in production)');
    });
</script>

{% endblock %}